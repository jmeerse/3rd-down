---
title: "3rd_down"
output: html_document
date: '2022-06-29'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(nflfastR)
library(nflreadr)
library(tidyverse)
library(ggimage)

options(scipen = 999)

```

```{r data and cleaning}
pbp <- load_pbp(2018:2021)

pbp <- pbp[!is.na(pbp$yards_gained), ]
pbp <- pbp[!is.na(pbp$down), ]

runpass <- pbp %>% filter(play_type == "run" | play_type == "pass")

remove(pbp) 

ave_run <- runpass %>% group_by(posteam, down) %>% 
  filter(play_type == "run") %>% 
  summarise(averun = mean(yards_gained, na.rm = TRUE),
            n_run = n()) %>% 
  ungroup()

ave_pass <- runpass %>% group_by(posteam, down) %>% 
  filter(play_type == "pass") %>% 
  summarise(avepass = mean(yards_gained, na.rm = TRUE),
            n_pass = n()) %>% 
  ungroup()

avs <- left_join(ave_pass, ave_run, by = c("posteam", "down"))

avs <- left_join(avs, teams_colors_logos, by = c("posteam" = "team_abbr") )







```

graphs

```{r graphs}
library(hrbrthemes) #gives lots of font error/warnings

runpass %>% filter(play_type == "run") %>% 
  ggplot(aes(x = yards_gained, y = down, group = down)) + 
  geom_boxplot() #boxplot of runs by downs

runpass %>% filter(play_type == "pass") %>% 
  ggplot(aes(x = yards_gained, y = as.factor(down))) + 
  geom_boxplot() +
  stat_summary(fun = "mean", geom="point", color = "red") +
  labs(title = "Ave Passing Yards by Down") #boxplot of runs by downs


avs %>% ggplot(aes(x = averun, y = avepass, shape = as.factor(down), color = as.factor(down))) +
  geom_point() + theme_light() #dotplot, shape and color by down



avs %>% ggplot(aes(x = averun, y = avepass)) +
  geom_image(aes(image = team_logo_wikipedia), size = 0.05) +
  geom_abline(slope = 1, intercept = 0) +
  facet_wrap(~ down)

avs %>% ggplot(aes(x = averun, y = avepass)) +
  geom_image(aes(image = team_logo_wikipedia), size = 0.05) +
  geom_abline(slope = 1, intercept = 0) +
  facet_wrap(~ down)
```

